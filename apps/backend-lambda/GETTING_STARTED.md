# ğŸ¦€ Rust Lambda API - å®Œå…¨ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã€Rustã§æ›¸ã‹ã‚ŒãŸã‚·ãƒ³ãƒ—ãƒ«ãªHello World APIã‚’AWS Lambdaã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ï¼

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§

### ğŸš€ ä»Šã™ãå§‹ã‚ã‚‹

1. **[QUICKSTART.md](../../infra/terraform/envs/lambda-dev/QUICKSTART.md)** - æœ€çŸ­ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ‰‹é †ï¼ˆ15åˆ†ï¼‰
   - ã™ãã«APIã‚’å‹•ã‹ã—ãŸã„æ–¹ã¯ã“ã¡ã‚‰
   - ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒšã™ã‚‹ã ã‘ã§å®Œäº†

2. **[DEPLOYMENT.md](../../infra/terraform/envs/lambda-dev/DEPLOYMENT.md)** - è©³ç´°ãªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼ˆè¶…åˆå¿ƒè€…å‘ã‘ï¼‰
   - å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ã—ã„è§£èª¬
   - ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä»˜ã
   - AWSåˆå¿ƒè€…ã§ã‚‚å®‰å¿ƒ

### ğŸ“– ç†è§£ã‚’æ·±ã‚ã‚‹

3. **[README.md](./README.md)** - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
   - APIã®ä»•æ§˜
   - ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã®æ–¹æ³•
   - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

4. **[ARCHITECTURE.md](./ARCHITECTURE.md)** - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸
   - ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ
   - ã‚³ã‚¹ãƒˆæœ€é©åŒ–
   - ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

## ğŸ¯ ã‚ãªãŸã«åˆã£ãŸå§‹ã‚æ–¹

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ã¨ã«ã‹ãæ—©ããƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„ï¼

â†’ **[QUICKSTART.md](../../infra/terraform/envs/lambda-dev/QUICKSTART.md)** ã‚’è¦‹ã‚‹

```bash
# 5ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†
1. AWSèªè¨¼è¨­å®šï¼ˆ1åˆ†ï¼‰
2. ECRãƒªãƒã‚¸ãƒˆãƒªä½œæˆï¼ˆ2åˆ†ï¼‰
3. Dockerãƒ“ãƒ«ãƒ‰ï¼†ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆ5-10åˆ†ï¼‰
4. Terraformå¤‰æ•°è¨­å®šï¼ˆ1åˆ†ï¼‰
5. ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ3-5åˆ†ï¼‰
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: AWSåˆã‚ã¦ã§ä¸å®‰...ä¸å¯§ã«æ•™ãˆã¦ï¼

â†’ **[DEPLOYMENT.md](../../infra/terraform/envs/lambda-dev/DEPLOYMENT.md)** ã‚’è¦‹ã‚‹

```bash
# ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§è§£èª¬
- å„ã‚³ãƒãƒ³ãƒ‰ã®æ„å‘³ã‚’èª¬æ˜
- ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã¨ãã®å¯¾å‡¦æ³•
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä»˜ãï¼ˆäºˆå®šï¼‰
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: ä»•çµ„ã¿ã‚’ç†è§£ã—ã¦ã‹ã‚‰å§‹ã‚ãŸã„

â†’ **[ARCHITECTURE.md](./ARCHITECTURE.md)** ã‚’è¦‹ã‚‹

```bash
# ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã‚’ç†è§£
- ãªãœã“ã®æ§‹æˆãªã®ã‹
- ã©ã†ã‚„ã£ã¦å‹•ã„ã¦ã„ã‚‹ã®ã‹
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ã©ã†ãªã£ã¦ã„ã‚‹ã®ã‹
```

## ğŸ› ï¸ ä¾¿åˆ©ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ

ã™ã¹ã¦ã®æ“ä½œã‚’ç°¡å˜ã«ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”¨æ„ã—ã¾ã—ãŸï¼š

### 1. ãƒ“ãƒ«ãƒ‰ï¼†ãƒ—ãƒƒã‚·ãƒ¥

```bash
./scripts/build-and-push.sh dev
# ã¾ãŸã¯
./scripts/build-and-push.sh prod v1.0.0
```

è‡ªå‹•çš„ã«ï¼š
- ECRã«ãƒ­ã‚°ã‚¤ãƒ³
- Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
- ECRã«ãƒ—ãƒƒã‚·ãƒ¥

### 2. Lambdaé–¢æ•°ã‚’æ›´æ–°

```bash
./scripts/update-lambda.sh dev
# ã¾ãŸã¯
./scripts/update-lambda.sh prod v1.0.0
```

ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸã‚‰ã€ã“ã®ã‚³ãƒãƒ³ãƒ‰ä¸€ç™ºã§æ›´æ–°å®Œäº†ï¼

### 3. APIãƒ†ã‚¹ãƒˆ

```bash
./scripts/test-api.sh dev
```

è‡ªå‹•çš„ã«ï¼š
- Hello Worldã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆ
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆ
- ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç¢ºèª

## ğŸ“‹ å‰ææ¡ä»¶

ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ãŒå¿…è¦ã§ã™ï¼š

| ãƒ„ãƒ¼ãƒ« | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• |
|--------|-----------|----------------|
| AWS CLI | v2.x | [å…¬å¼ã‚µã‚¤ãƒˆ](https://aws.amazon.com/cli/) |
| Terraform | >= 1.7.0 | [å…¬å¼ã‚µã‚¤ãƒˆ](https://www.terraform.io/) |
| Docker | >= 24.0 | [å…¬å¼ã‚µã‚¤ãƒˆ](https://www.docker.com/) |
| Rust | >= 1.70 | [rustup](https://rustup.rs/)ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |

### macOSã®å ´åˆ

```bash
# HomebrewçµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
brew install awscli terraform docker
```

### ç¢ºèª

```bash
aws --version      # aws-cli/2.15.0
terraform --version # Terraform v1.7.0
docker --version    # Docker version 24.0.0
```

## ğŸŒŸ ä¸»ãªç‰¹å¾´

### âœ… ç„¡æ–™ã§é‹ç”¨å¯èƒ½

AWSç„¡æ–™æ å†…ã§å®Œå…¨ã«é‹ç”¨å¯èƒ½ï¼š
- Lambda: æœˆ100ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆç„¡æ–™
- API Gateway: æœˆ100ä¸‡ã‚³ãƒ¼ãƒ«ç„¡æ–™ï¼ˆ12ãƒ¶æœˆï¼‰
- CloudWatch Logs: æœˆ5GBç„¡æ–™

â†’ æœˆ10ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã‚‰å®Œå…¨ç„¡æ–™ï¼

### âœ… ã‚»ã‚­ãƒ¥ã‚¢

- CORSè¨­å®šã§Vercelãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯
- IAMæœ€å°æ¨©é™ã®åŸå‰‡
- dev/prodç’°å¢ƒå®Œå…¨åˆ†é›¢

### âœ… é«˜é€Ÿ

- Rustã®é«˜é€Ÿæ€§
- Lambdaé–¢æ•°ã®è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆæœ€å°åŒ–

### âœ… ç°¡å˜ãƒ‡ãƒ—ãƒ­ã‚¤

- ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸€ç™ºã§ãƒ‡ãƒ—ãƒ­ã‚¤
- Terraformã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ã‚³ãƒ¼ãƒ‰ç®¡ç†
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚‚ç°¡å˜

## ğŸ“ å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

### Ruståˆå¿ƒè€…å‘ã‘

- [The Rust Bookï¼ˆæ—¥æœ¬èªç‰ˆï¼‰](https://doc.rust-jp.rs/book-ja/)
- [Rustlings](https://github.com/rust-lang/rustlings) - å®Ÿè·µçš„ãªæ¼”ç¿’

### AWS Lambda

- [AWS Lambda Developer Guide](https://docs.aws.amazon.com/lambda/latest/dg/)
- [AWS Lambda Rust Runtime](https://github.com/awslabs/aws-lambda-rust-runtime)

### Terraform

- [Terraformå…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://developer.hashicorp.com/terraform/tutorials)
- [Terraform AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)

## ğŸ’¡ ã‚ˆãã‚ã‚‹è³ªå•

### Q1: æœ¬å½“ã«ç„¡æ–™ã§ä½¿ãˆã‚‹ã®ï¼Ÿ

A: ã¯ã„ï¼AWSç„¡æ–™æ å†…ï¼ˆæœˆ100ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰ãªã‚‰å®Œå…¨ç„¡æ–™ã§ã™ã€‚è¶…éã—ã¦ã‚‚å¾“é‡èª²é‡‘ãªã®ã§ã€å°‘é‡ãªã‚‰æ•°å††ç¨‹åº¦ã§ã™ã€‚

### Q2: RustãŒã‚ã‹ã‚‰ãªãã¦ã‚‚å¤§ä¸ˆå¤«ï¼Ÿ

A: å¤§ä¸ˆå¤«ã§ã™ï¼ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™ã€‚ã¾ãšã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã€å¾ã€…ã«Rustã‚’å­¦ã‚“ã§ã„ãã¾ã—ã‚‡ã†ã€‚

### Q3: é–“é•ãˆã¦èª²é‡‘ã•ã‚ŒãŸã‚‰æ€–ã„...

A: AWS Billing Consoleã§äºˆç®—ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®šã§ãã¾ã™ã€‚æœˆ$5ã§ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®šã—ã¦ãŠã‘ã°å®‰å¿ƒã§ã™ã€‚

### Q4: devç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã®é•ã„ã¯ï¼Ÿ

A: ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ï¼š

| é …ç›® | dev | prod |
|------|-----|------|
| Lambdaé–¢æ•° | åˆ¥é–¢æ•° | åˆ¥é–¢æ•° |
| API URL | åˆ¥URL | åˆ¥URL |
| CORSè¨±å¯URL | localhost/dev.vercel.app | www.kohta-tech-blog.com |
| ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚º | 128MB | 256MB |
| ãƒ­ã‚°ä¿æŒ | 7æ—¥ | 30æ—¥ |

### Q5: ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰ã©ã†ã™ã‚Œã°ã„ã„ï¼Ÿ

A: [DEPLOYMENT.md](../../infra/terraform/envs/lambda-dev/DEPLOYMENT.md)ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã¯Issueã‚’ç«‹ã¦ã¦ãã ã•ã„ï¼

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. ã¾ãšã¯ãƒ‡ãƒ—ãƒ­ã‚¤

**[QUICKSTART.md](../../infra/terraform/envs/lambda-dev/QUICKSTART.md)** ã‚’è¦‹ã¦ã€15åˆ†ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨é€£æº

ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸAPIã‚’Vercelã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰å‘¼ã³å‡ºã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```typescript
// apps/frontend/lib/api-client/lambda.ts
const API_URL = process.env.NEXT_PUBLIC_API_URL_DEV;

export async function fetchHello() {
  const response = await fetch(`${API_URL}/hello`);
  return response.json();
}
```

Vercelã®ç’°å¢ƒå¤‰æ•°ã«è¨­å®šï¼š
```
NEXT_PUBLIC_API_URL_DEV=https://abc123xyz.execute-api.ap-northeast-1.amazonaws.com
```

### 3. APIã‚’æ‹¡å¼µ

`src/main.rs`ã‚’ç·¨é›†ã—ã¦ã€æ–°ã—ã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ï¼š

```rust
match path {
    "/health" => { /* ... */ },
    "/hello" => { /* ... */ },
    "/api/users" => {
        // æ–°ã—ã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼
        json!({ "users": ["Alice", "Bob"] })
    },
    _ => { /* ... */ }
}
```

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§æ›´æ–°ï¼š
```bash
./scripts/build-and-push.sh dev
./scripts/update-lambda.sh dev
```

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¿½åŠ 

å°†æ¥çš„ã«ã¯RDS PostgreSQLã‚’è¿½åŠ ã—ã¦ã€æœ¬æ ¼çš„ãªAPIã«ã§ãã¾ã™ã€‚

## ğŸ¤ ã‚µãƒãƒ¼ãƒˆ

- ãƒã‚°å ±å‘Š: GitHubã®Issue
- æ©Ÿèƒ½ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: GitHubã®Issue
- è³ªå•: GitHubã®Discussions

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

---

ãã‚Œã§ã¯ã€æ¥½ã—ã„Rust + AWS Lambdaãƒ©ã‚¤ãƒ•ã‚’ï¼ğŸ¦€âœ¨
